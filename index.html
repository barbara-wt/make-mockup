<!doctype html>

<head>
  <link rel="prefetch" href="mockup.svg">

  <style>
    [onclick] {
      cursor: pointer;
    }

    body {
      margin: 0;
    }

    main > svg {
      display: block;
      width: 100%;
      height: auto;
    }

    tspan {
      -webkit-font-smoothing: antialiased;
    }
  </style>
</head>

<body>
  <main></main>

  <script>{
    // third-party snippets

    /*! Based on tiny Js Pub/Sub
     * http://anasnakawa.com/
     * Copyright (c) Ben Alman, Anas Nakawa, Tomek Wiszniewski
     * MIT License
     */
    const events = (() => {
      const cache = {};

      return {
        send: (event, data) => {
          (cache[event] = cache[event] || new Event(event)).data = data;
          dispatchEvent(cache[event]);
        },

        listen: addEventListener;

        forget: removeEventListener;
      };
    })();


    // the SVG
    fetch(
      'mockup.svg'
    ).then(response => (
      response.text()
    )).then(svgContent => {
      // Inject SVG
      const svgMarkup = (svgContent
        .replace(/<\?.*?\?>/g, '')
        .replace(/<!--.*?-->/g, '')
      );
      const main = document.querySelector('main');
      main.innerHTML = svgMarkup;

      // Functions
      const svg = main.querySelector('svg');

      window.goto = (id) => {
        const page = svg.getElementById(id);
        const width = page.getAttribute('width');
        const height = page.getAttribute('height');
        svg.setAttribute('width', width);
        svg.setAttribute('height', height);
        svg.setAttribute('viewBox', [
          page.getAttribute('x'),
          page.getAttribute('y'),
          width,
          height,
        ].join(' '));

        // Track history
        window.location.hash = `#/${id}`;
      }

      // Restore page from URL
      const hash = window.location.hash;
      const hashRoute = /^#\//;
      if (hashRoute.test(hash)) {
        window.goto(hash.replace(hashRoute, ''));
      }
    });
  }</script>
</body>
